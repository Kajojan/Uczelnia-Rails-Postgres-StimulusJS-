<div class="flex flex-col justify-center" data-controller="grade">
    <h1 class="mb-4 text-center text-6xl font-bold"><%= @course.name %></h1>
    <img class="border m-auto w-9/12 h-auto" src="" alt="Image">
    <div>
       <div>
        <% if current_user == @course.teacher %>
            <table class="min-w-full border border-gray-300 rounded">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="border p-2 text-left">Student</th>
                        <th class="border p-2 text-left">Oceny</th>
                        <th class="border p-2 text-left">Dodaj</th>

                    </tr>
                </thead>
                <tbody>
                    <% @students.each do |studentDetails| %>
                        <tr class="border-b">
                        <td class="border p-2"><%= studentDetails.first_name %> <%= studentDetails.last_name %></td>
                        <td class="border p-2"> 
                            <% studentDetails.grades.each do |grade| %>
                                <div data-grade-target="grade" data-url="<%= grade_path(grade) %>" class="flex items-center gap-2 mb-1">
                                    <span class="px-2 py-1 border rounded"><%= grade.value %></span>
                                    
                                    <button data-action="click->grade#open" class="bg-blue-500 text-white px-2 py-1 rounded">Zmień</button>

                                    <button data-action="click->grade#remove" class="bg-red-500 text-white px-2 py-1 rounded">Usuń</button>

                                    <div data-grade-target="form" class="hidden fixed inset-0 flex items-center justify-center z-50">
                                        <div class="absolute inset-0 bg-gray-500 bg-opacity-30 backdrop-blur-sm"></div>

                                        <%= form_with url: course_grade_path(@course, grade), method: :patch,
                                                class:"relative z-20 bg-white p-6 rounded shadow-lg flex flex-col gap-4 w-80", local: true do |f| %>
                                            <%= hidden_field_tag :student_id, studentDetails.id %>
                                            <%= hidden_field_tag :grade_id, grade.id %>
                                            <%= number_field_tag :grade, grade.value, in: 2.0..5.0, class: "border p-1 rounded" %>
                                            <div class="flex justify-between">
                                            <%= f.submit "Zapisz", class: "bg-green-500 text-white px-4 py-2 rounded cursor-pointer" %>
                                            <button type="button" class="bg-red-500 text-white px-4 py-2 rounded" data-action="click->grade#close">Zamknij</button>
                                            </div>
                                        <% end %>
                                    </div>
                                </div>
                            <% end %>
                        </td>
                        <td class="border p-2 ">
                            <button data-action="click->grade#newGradeOpen" class="bg-blue-500 text-white px-2 py-1 rounded">Dodaj</button>
                             <div data-grade-target="newForm" class="hidden fixed inset-0 flex items-center justify-center z-50">
                                <div class="absolute inset-0 bg-gray-500 bg-opacity-30 backdrop-blur-sm"></div>
                                <%= form_with model: Grade.new, url: course_grades_path(@course),
                                    class:"relative z-20 bg-white p-6 rounded shadow-lg flex flex-col gap-4 w-80", local: true do |f| %>
                                            <%= hidden_field_tag :student_id, studentDetails.id %>
                                            <%= f.number_field :value, value: 2, in: 2.0..5.0, step: 0.5, class: "border p-1 rounded" %>                                            <div class="flex justify-between">
                                            <%= f.submit "Dodaj", class: "bg-green-500 text-white px-4 py-2 rounded cursor-pointer" %>
                                            <button type="button" class="bg-red-500 text-white px-4 py-2 rounded" data-action="click->grade#close">Zamknij</button>
                                            </div>
                                 <% end %>
                            </div>

                        </td>
                    <% end %>
                </tbody>
            </table>
        
        <% else %>
            <% if @grade.present? %>
                <% @grade.each do |grade| %>
                <h1 class="mb-4 text-center text-6xl font-bold"><%= grade.value %></h1>
                <% end %>
            <% else %>
                <h1 class="mb-4 text-center text-6xl font-bold">Brak ocen</h1>
            <% end %>
        <% end %>
        </div>

    </div>
</div>
